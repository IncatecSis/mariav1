{% load static %}
<style>
body {
    font-family: Arial, sans-serif;
}

/* El pop-up est치 oculto por defecto */
.popup_e {
    display: none;
    position: fixed;
    z-index: 1050;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4); /* Fondo oscuro */
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Contenido del pop-up */
.popup-content_e {
    background-color: #fff;
    margin: 20% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 100%;
    max-width: 450px;
    max-height: 80vh;
    border-radius: 8px;
    overflow-y: auto;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}
/* Scroll personalizado para WebKit (Chrome, Safari) */
.popup-content_e::-webkit-scrollbar {
    width: 8px; /* Ancho del scrollbar */
}

.popup-content_e::-webkit-scrollbar-track {
    background: #f1f1f1; /* Color del track del scrollbar */
    border-radius: 10px;
}

.popup-content_e::-webkit-scrollbar-thumb {
    background-color: #8f8585; /* Color del scrollbar */
    border-radius: 10px;
    border: 2px solid #e4d6d6; /* Borde alrededor del scrollbar para un look m치s detallado */
}

.popup-content_e::-webkit-scrollbar-thumb:hover {
    background-color: #555; /* Color del scrollbar al pasar el mouse por encima */
    transition: all 300ms;
}

/* Bot칩n de cerrar */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}


</style>

<div class="row">
    <div class="col-md-6 offset-md-3">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="" id="sede-periodo-form">
                    {% csrf_token %}
                    <div class="mb-3">
                        <input type="hidden" name="seleccionar_sede_periodo" value="true">
                        <label for="sede_id" class="form-label">Selecciona la Sede</label>
                        <select class="form-select" id="sede_id" name="sede" required>
                            <option value="" disabled selected>Seleccione una sede</option>
                            {% for id, nombre_sede in sede_choices %}
                                <option value="{{ id }}" {% if request.session.sede_id == id %}selected{% endif %}>{{ nombre_sede }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="periodo_id" class="form-label">Selecciona el Periodo</label>
                        <select class="form-select" id="periodo_id" name="periodo" required>
                            <option value="" disabled selected>Seleccione un periodo</option>
                            {% for id, nombre_periodo in periodo_choices %}
                                <option value="{{ id }}" {% if request.session.periodo_id == id %}selected{% endif %}>{{ nombre_periodo }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    {% if request.user.is_superuser or request.user.roles_id == 2 %}
                        <button type="button" class="btn btn-soft-primary" onclick="toggleModal('modalSede')">Crear sede</button>
                        <button type="button" class="btn btn-soft-primary" onclick="toggleModal('modalPeriodo')">Crear periodo</button>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>
</div>
<div id="modalSede" class="popup_e" style="display: none;">
    <div class="popup-content_e">
        <span data-close="modalSede" class="close">&times;</span>
        <h2>Crear sede</h2><br>
        <form method="POST" action="{% url 'Incatec:index' %}">
            {% csrf_token %}
            <input type="hidden" name="crear_sede" value="1">
            <div class="mb-3 d-flex align-items-center justify-content-between">
                <label class="form-label mb-0 me-2" style="width: 50%;" for="nombre_sede">Nombre de la sede: </label>
                <input type="text" class="form-control" name="nombre" id="nombre" required>
            </div>    
            <div class="mb-3 d-flex align-items-center justify-content-between">
                <label class="form-label mb-0 me-2" style="width: 50%;" for="direccion_sede">Direccion de la sede: </label>
                <input type="text" class="form-control" name="direccion" id="direccion" required>
            </div>
            <button type="submit" class="btn btn-soft-primary form-control text-center">
                Crear sede
            </button>
        </form>
    </div>
</div>
<div id="modalPeriodo" class="popup_e" style="display: none;">
    <div class="popup-content_e">
        <span data-close="modalPeriodo" class="close">&times;</span>
        <h2>Crear periodo</h2><br>
        <form method="POST" action="{% url 'Incatec:index' %}">
            {% csrf_token %}
            <input type="hidden" name="crear_periodo" value="1">

            <div class="row mb-3">
                <label for="anio-select" class="col-sm-4 col-form-label">A침o:</label>
                <div class="col-sm-8">
                    <select name="anio" id="anio-select" class="form-select" required></select>
                </div>
            </div>  
            <div class="row mb-3">
                <label for="semestre" class="col-sm-4 col-form-label">Semestre:</label>
                <div class="col-sm-8">
                    <select class="form-select" name="semestre" id="semestre" required>
                        <option value="1">A</option>
                        <option value="2">B</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn btn-soft-primary form-control text-center">
                Crear periodo
            </button>
        </form>
    </div>
</div>

<script>
    function toggleModal(modalId) {
        var modal = document.getElementById(modalId);
        modal.style.display = (modal.style.display === 'block') ? 'none' : 'block';
    }

    window.onclick = function(event) {
        var modals = document.getElementsByClassName('modal');
        for (var c = 0; c < modals.length; c++) {
            if (event.target === modals[c]) {
                modals[c].style.display = 'none';
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const sedeField = document.getElementById('sede_id');
        const periodoField = document.getElementById('periodo_id');
        const form = document.getElementById('sede-periodo-form');

        function checkAndSubmitForm() {
            if (sedeField.value && periodoField.value) {
                form.submit();
            }
        }
        sedeField.addEventListener('change', checkAndSubmitForm);
        periodoField.addEventListener('change', checkAndSubmitForm);
    });

    const Selectyear = document.getElementById('anio-select');
    for (let year = 2020; year <= 2040; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        Selectyear.appendChild(option);
    }
</script>
<script src="{% static 'js/pop-pup.js' %}"></script>